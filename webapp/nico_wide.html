<!DOCTYPE html>
<html>
<head>
    <link rel="icon" href="favicon.ico" type="image/x-icon"/>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
    <title>BatHome</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!-- Handlebars -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.1.1/handlebars.min.js"></script>
    <!-- Dygraph -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.js"></script>
    <script src="http://dygraphs.com/extras/smooth-plotter.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.css" />

    <script type="text/javascript" src="/webapp/js/graphs.js"></script>
    <script type="text/javascript" src="/webapp/js/templated_thing.js"></script>
    <script type="text/javascript" src="/webapp/js/scene_list.js"></script>
    <script type="text/javascript" src="/webapp/js/mqtt_device_info.js"></script>
    <script type="text/javascript" src="/webapp/js/media_player.js"></script>
    <script type="text/javascript" src="/webapp/js/lamp.js"></script>
    <script type="text/javascript" src="/webapp/js/baticueva_tv_extras.js"></script>
    <script type="text/javascript" src="/webapp/js/app.js"></script>
    <script type="text/javascript" src="/webapp/tmpls.js"></script>

    <!-- https://getbootstrap.com/docs/3.4/customize/ -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet"        href="css/things_style.css">
    <link rel="stylesheet"        href="css/custom_styles.css">

<script>
var app = new DumbHouseApp();
$.when(app.is_ready).then(function() {
    app.show_list_of(Lamp, '#lamps_list');
    app.show_list_of_media_players('#media_players_list');

    app.show_scenes('#scenes_ui');
    app.show_list_of(MqttDeviceInfo, '#mqtt_network_status');

    var daily_target_cals = 1950;
    app.get_mfp_stats("mfp_chart", daily_target_cals, function(days, diary, stats, mfp_summary) {
        $("#mfp_stats_title").text(mfp_summary.title);
        $("#mfp_eatmeter_desc").html(mfp_summary.text);
        $("#mfp_eatmeter_bar").val(stats.period_target_cals_pct - 50);

        // Exercise log
        for (var day of days) {
            var log = diary[day];
            var cls = (log.exercise_minutes > 0)? 'exercise' : 'noexercise';
            $("#mfp_exercise").append("<li class='"+cls+"'>"+day.substr(5)+"</li>");
        }
    });
});
</script>

<style>
.column {
    float: left;
    border: 1px solid black;
    padding: 5px;
    margin: 5px;
}
.scenes_column {
    width: 450px;
}

.mfp_column {
    width: calc(100% - 470px); /* 100% - icon width */
}

.mfp_column h2 {
    margin: 0;
    padding: 5px;
}

.lamps_column {
    clear: left;
    width: 40%;
}
.mps_column {
    width: 57%;
}
</style>

</head>

<body>
<div class="container-fluid">
    <div class="column scenes_column">
        <a href="#" onClick="return app.invoke_action('/scene_set/dinner');">
            <img src="shortcut_icons/dinner.jpg" class="player_shortcut"/></a>
        <a href="#" onClick="return app.invoke_action('/scene_set/living_room_evening');">
            <img src="shortcut_icons/evening.jpg" class="player_shortcut"/></a>
        <a href="#" onClick="return app.invoke_action('/scene_set/sleepy');">
            <img src="shortcut_icons/sleepy.jpg" class="player_shortcut"/></a>
        <a href="#" onClick="return app.invoke_action('/scene_set/world_off');">
            <img src="shortcut_icons/world_off.png" class="player_shortcut"/></a>
    </div>

    <div class="column mfp_column">
        <h2 id="mfp_stats_title">MFP</h2>

        <table width="100%">
        <tr>
            <td width="42%">
                <div id="mfp_eatmeter_desc">Loading MFP stats...</div>
            </td>

            <td width="58%">
                <table id="mfp_eatmeter">
                <tr>
                    <td style="width: 42%; background-color: yellow;">UNDER EATING</td>
                    <td style="width: 16%; background-color: green;">TARGET</td>
                    <td style="width: 42%; background-color: red;">OVER EATING</td>
                </tr>
                <tr>
                    <td colspan="3">
                        <meter id="mfp_eatmeter_bar" max=100 min=0 high=58 low=42 optimum=50></meter>
                    </td>
                </tr>
                </table>

                <p id="mfp_exercise_legend">Training days:</p>
                <ul id="mfp_exercise">
                </ul>
            </td>
        </tr>
        </table>
    </div>

    <div class="column lamps_column">
        <h2>Lamps</h2>
        <ul id="lamps_list" style="margin: 0; padding: 0;" />
        </ul>
    </div>

    <div class="column mps_column">
        <h2>Media players</h2>
        <ul id="media_players_list" style="margin: 0; padding: 0;" />
        </ul>
    </div>

    <hr/>

    <div style="clear: both">
        <h2><a href="#" onclick="$('#mfp_chart').toggle(); return false;">MFP daily</a></h2>
        <div id="mfp_chart" style="width: 100%"></div>

        <h2><a href="#local_co2_temp_h2" id="local_co2_temp_h2"
                onclick="return app.toggle_Local_Sensors_Plot('local_co2_temp');">
                Local sensors</a></h2>
        <div id="local_co2_temp" style="display: none; width: 100%"></div>

        <div style="float: left; width: 50%">
            <h2><a href="#weather_plots" id="weather_plots"
                    onclick="return app.toggle_Weather_Plots('rain_forecast', 'temp_forecast', 24);">
                    Rain forecast</a></h2>
            <div id="rain_forecast" style="display: none; width: 100%"></div>
        </div>

        <div style="float: left; width: 50%">
            <h2><a href="#weather_plots"
                    onclick="return app.toggle_Weather_Plots('rain_forecast', 'temp_forecast', 24);">
                    Temperature forecast, hourly</a></h2>
            <div id="temp_forecast" style="display: none; width: 100%"></div>
        </div>
    </div>



    <h1>REFACTOR</h1>
    <h2>Misc</h2>
    <p><a href="/world/scan_chromecasts" target="blank">Rescan Chromecasts</a></p>

    <b>Reauth slideshow</b>
    <ol>
        <li><a href="/pcloud_slideshow/auth/step1">Get auth link</a>. Goto link, copy code.</li>
        <li>With the code, goto this url (append /$code to the url): <a href="/pcloud_slideshow/auth/step2">Auth step 2</a></li>
        <li>Stale cache? <a href="/pcloud_slideshow/images/refresh_cache">Refresh</a></li>
    </ol>

    <h2>Mqtt network status</h2>
    <table id="mqtt_network_status" />
    <tr>
        <td>Thing</td>
        <td>Battery</td>
        <td>Link quality</td>
    </tr>
    </table>

    <h2>List of all known scenes</h2>
    <ul id="scenes_ui"></ul>

    <h2>Realtime MQTT Log</h2>
    <ul id="mqtt_log">
    </ul>
</div>
</body>
</html>
